<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™æœƒäº‹å·¥ AI é«˜äº®æ‘˜è¦å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #FFFFFF;
            color: #111827;
            line-height: 1.6;
        }

        .container {
            max-width: 768px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            text-align: center;
            padding: 24px 0;
            border-bottom: 1px solid #E5E7EB;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #111827;
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .upload-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            border: 2px dashed #E5E7EB;
            border-radius: 8px;
            background-color: #F9FAFB;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 120px;
        }

        .upload-button:hover {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }

        .upload-button.active {
            border-color: #10B981;
            background-color: #ECFDF5;
        }

        .upload-button span {
            font-size: 16px;
            color: #6B7280;
            margin-top: 8px;
        }

        .upload-button.active span {
            color: #10B981;
        }

        .upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .video-section {
            margin-bottom: 24px;
            padding: 16px;
            background-color: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            display: none;
        }

        .video-player {
            width: 100%;
            max-height: 400px;
            border-radius: 8px;
        }

        .audio-player {
            width: 100%;
            border-radius: 8px;
        }

        .highlights-section {
            display: none;
        }

        .highlights-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .highlights-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .export-all-btn {
            background-color: #3B82F6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .export-all-btn:hover {
            background-color: #2563EB;
        }

        .highlight-card {
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .highlight-card.expanded {
            background-color: #EFF6FF;
            border-color: #3B82F6;
        }

        .time-controls {
            display: none;
            margin: 12px 0;
            padding: 12px;
            background-color: #F3F4F6;
            border-radius: 6px;
            border: 1px solid #D1D5DB;
        }

        .time-controls.show {
            display: block;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .time-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            font-size: 14px;
        }

        .time-label {
            font-size: 14px;
            color: #6B7280;
            min-width: 60px;
        }

        .preview-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .preview-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            background-color: #6B7280;
            color: white;
        }

        .preview-btn:hover {
            background-color: #4B5563;
        }

        .preview-btn.primary {
            background-color: #3B82F6;
        }

        .preview-btn.primary:hover {
            background-color: #2563EB;
        }

        .highlight-time {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .highlight-title {
            font-size: 16px;
            font-weight: 500;
            color: #111827;
            margin-bottom: 12px;
        }

        .highlight-actions {
            display: flex;
            gap: 12px;
        }

        .play-btn, .export-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .play-btn {
            background-color: #3B82F6;
            color: white;
        }

        .play-btn:hover {
            background-color: #2563EB;
        }

        .export-btn {
            background-color: white;
            color: #6B7280;
            border: 1px solid #E5E7EB;
        }

        .export-btn:hover {
            background-color: #F9FAFB;
            color: #374151;
        }

        .export-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #E5E7EB;
            color: #9CA3AF;
        }

        .export-btn:disabled:hover {
            background-color: #E5E7EB;
            color: #9CA3AF;
        }

        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .message.success {
            background-color: #ECFDF5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }

        .message.error {
            background-color: #FEF2F2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }

        .hidden {
            display: none !important;
        }

        input[type="file"] {
            display: none;
        }

        @media (max-width: 640px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .highlights-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœï¸ æ•™æœƒäº‹å·¥ AI é«˜äº®æ‘˜è¦å·¥å…·</h1>
        </div>

        <div id="messageArea"></div>

        <div class="upload-section">
            <div class="upload-button" id="videoUpload">
                <div class="upload-icon">ğŸ¬</div>
                <span>ä¸Šå‚³åª’é«”</span>
                <input type="file" id="videoFile" accept=".mp4,.avi,.mov,.mkv,.webm,.mp3,.wav,.m4a,.aac,.ogg">
            </div>
            
            <div class="upload-button" id="highlightsUpload">
                <div class="upload-icon">ğŸ“</div>
                <span>ä¸Šå‚³ Highlights JSON</span>
                <input type="file" id="highlightsFile" accept=".json">
            </div>
        </div>

        <div class="video-section" id="videoSection">
            <video class="video-player" id="videoPlayer" controls style="display: none;">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´è¦–é »æ’­æ”¾
            </video>
            <audio class="audio-player" id="audioPlayer" controls style="display: none;">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³é »æ’­æ”¾
            </audio>
        </div>

        <div class="highlights-section" id="highlightsSection">
            <div class="highlights-header">
                <h2 class="highlights-title">ğŸ”¦ é«˜äº®æ‘˜è¦ç‰‡æ®µ</h2>
                <div style="display: flex; gap: 8px;">
                    <button class="export-all-btn" id="exportAllBtn">ğŸ“¤ å°å‡ºå…¨éƒ¨æ‘˜è¦</button>
                    <button class="export-all-btn" id="exportAllVideoBtn">ğŸ¬ å°å‡ºå…¨éƒ¨è¦–é »</button>
                </div>
            </div>
            <div id="highlightsList"></div>
        </div>
    </div>

    <script>
        let currentVideo = null;
        let currentHighlights = [];

        // åˆå§‹åŒ–äº‹ä»¶ç›£è½
        document.addEventListener('DOMContentLoaded', function() {
            // è¦–é »ä¸Šå‚³
            document.getElementById('videoUpload').addEventListener('click', function() {
                document.getElementById('videoFile').click();
            });

            document.getElementById('videoFile').addEventListener('change', handleVideoUpload);

            // JSON ä¸Šå‚³
            document.getElementById('highlightsUpload').addEventListener('click', function() {
                document.getElementById('highlightsFile').click();
            });

            document.getElementById('highlightsFile').addEventListener('change', handleHighlightsUpload);

            // å°å‡ºå…¨éƒ¨
            document.getElementById('exportAllBtn').addEventListener('click', exportAllHighlights);
            document.getElementById('exportAllVideoBtn').addEventListener('click', exportAllVideoSegments);
        });

        function showMessage(text, type = 'success') {
            const messageArea = document.getElementById('messageArea');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            messageArea.appendChild(message);

            setTimeout(() => {
                message.remove();
            }, 5000);
        }

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('video', file);

            fetch('/upload-video', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentVideo = data.filename;
                    document.getElementById('videoUpload').classList.add('active');
                    document.getElementById('videoUpload').querySelector('span').textContent = 'âœ“ åª’é«”å·²ä¸Šå‚³';
                    
                    // æª¢æ¸¬æ–‡ä»¶é¡å‹ä¸¦è¨­ç½®ç›¸æ‡‰æ’­æ”¾å™¨
                    const fileExtension = data.filename.split('.').pop().toLowerCase();
                    const audioExtensions = ['mp3', 'wav', 'm4a', 'aac', 'ogg'];
                    const isAudio = audioExtensions.includes(fileExtension);
                    
                    const videoPlayer = document.getElementById('videoPlayer');
                    const audioPlayer = document.getElementById('audioPlayer');
                    
                    if (isAudio) {
                        audioPlayer.src = `/video/${data.filename}`;
                        audioPlayer.style.display = 'block';
                        videoPlayer.style.display = 'none';
                    } else {
                        videoPlayer.src = `/video/${data.filename}`;
                        videoPlayer.style.display = 'block';
                        audioPlayer.style.display = 'none';
                    }
                    
                    document.getElementById('videoSection').style.display = 'block';
                    
                    // è™•ç†ç¾æœ‰æ–‡ä»¶å’Œæ•¸æ“š
                    if (data.existing_files) {
                        handleExistingFiles(data.existing_files, data.existing_data);
                    }
                    
                    showMessage(data.message);
                } else {
                    showMessage(data.error, 'error');
                }
            })
            .catch(error => {
                showMessage('ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
            });
        }

        function handleHighlightsUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('highlights', file);

            fetch('/upload-highlights', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentHighlights = data.highlights;
                    document.getElementById('highlightsUpload').classList.add('active');
                    document.getElementById('highlightsUpload').querySelector('span').textContent = 'âœ“ JSON å·²ä¸Šå‚³';
                    
                    renderHighlights(data.highlights);
                    document.getElementById('highlightsSection').style.display = 'block';
                    
                    showMessage(data.message);
                } else {
                    showMessage(data.error, 'error');
                }
            })
            .catch(error => {
                showMessage('ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
            });
        }

        function renderHighlights(highlights) {
            const highlightsList = document.getElementById('highlightsList');
            highlightsList.innerHTML = '';

            highlights.forEach((highlight, index) => {
                const card = document.createElement('div');
                card.className = 'highlight-card';

                const startTime = formatTime(highlight.start);
                const endTime = formatTime(highlight.end);
                const duration = Math.round(highlight.end - highlight.start);

                card.innerHTML = `
                    <div class="highlight-time">${startTime} - ${endTime} (${duration}ç§’)</div>
                    <div class="highlight-title">âœ¨ ${highlight.title}</div>
                    <div class="highlight-actions">
                        <button class="play-btn" onclick="playSegment(${highlight.start}, ${highlight.end})">
                            â–¶ï¸ æ’­æ”¾ç‰‡æ®µ
                        </button>
                        <button class="preview-btn primary" onclick="toggleTimeControls(${index})">
                            âš™ï¸ èª¿æ•´æ™‚é–“
                        </button>
                        <button class="export-btn" onclick="exportHighlight(${index})">
                            ğŸ“„ å°å‡ºæ–‡å­—
                        </button>
                        <button class="export-btn" onclick="exportVideoSegment(${index})" disabled>
                            ğŸ¬ å°å‡ºè¦–é »
                        </button>
                    </div>
                    <div class="time-controls" id="timeControls${index}">
                        <div class="time-input-group">
                            <span class="time-label">é–‹å§‹æ™‚é–“:</span>
                            <input type="number" class="time-input" id="startTime${index}" value="${highlight.start.toFixed(1)}" step="0.1" min="0">
                            <span style="font-size: 12px; color: #6B7280;">ç§’</span>
                        </div>
                        <div class="time-input-group">
                            <span class="time-label">çµæŸæ™‚é–“:</span>
                            <input type="number" class="time-input" id="endTime${index}" value="${highlight.end.toFixed(1)}" step="0.1" min="0">
                            <span style="font-size: 12px; color: #6B7280;">ç§’</span>
                        </div>
                        <div class="preview-controls">
                            <button class="preview-btn primary" onclick="previewAdjustedSegment(${index})">
                                â–¶ï¸ é è¦½èª¿æ•´
                            </button>
                            <button class="preview-btn" onclick="resetTimeRange(${index})">
                                ğŸ”„ é‡ç½®
                            </button>
                            <button class="preview-btn primary" onclick="saveTimeAdjustment(${index})">
                                âœ… ç¢ºèªèª¿æ•´
                            </button>
                        </div>
                    </div>
                `;

                highlightsList.appendChild(card);
            });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function playSegment(start, end) {
            const videoPlayer = document.getElementById('videoPlayer');
            const audioPlayer = document.getElementById('audioPlayer');
            
            // ç¢ºå®šç•¶å‰ä½¿ç”¨çš„æ’­æ”¾å™¨
            const currentPlayer = videoPlayer.style.display !== 'none' ? videoPlayer : audioPlayer;
            
            if (!currentPlayer.src) {
                showMessage('è«‹å…ˆä¸Šå‚³åª’é«”æ–‡ä»¶', 'error');
                return;
            }

            currentPlayer.currentTime = start;
            currentPlayer.play();

            // è¨­ç½®çµæŸæ™‚é–“ç›£è½ï¼ˆå¯é¸ï¼‰
            const handleTimeUpdate = () => {
                if (currentPlayer.currentTime >= end) {
                    currentPlayer.pause();
                    currentPlayer.removeEventListener('timeupdate', handleTimeUpdate);
                }
            };
            
            currentPlayer.addEventListener('timeupdate', handleTimeUpdate);
        }

        function exportHighlight(index) {
            const highlight = currentHighlights[index];
            const data = {
                ...highlight,
                timestamp: new Date().toLocaleString('zh-TW')
            };

            fetch('/export-highlight', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                throw new Error('å°å‡ºå¤±æ•—');
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `highlight_${formatTime(highlight.start).replace(':', '_')}-${formatTime(highlight.end).replace(':', '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showMessage('æ‘˜è¦å·²å°å‡º');
            })
            .catch(error => {
                showMessage('å°å‡ºå¤±æ•—: ' + error.message, 'error');
            });
        }

        function handleExistingFiles(existingFiles, existingData) {
            // è™•ç†è½‰éŒ„æ–‡ä»¶
            if (existingFiles.has_transcript && existingData.transcript) {
                showMessage('âœ“ ç™¼ç¾ç¾æœ‰è½‰éŒ„æ–‡ä»¶', 'success');
                // å¯ä»¥åœ¨é€™è£¡é¡¯ç¤ºè½‰éŒ„å…§å®¹
            }
            
            // è™•ç†ç²¾è¯ç‰‡æ®µ
            if (existingFiles.has_segments && existingData.segments) {
                showMessage('âœ“ ç™¼ç¾ç¾æœ‰ç²¾è¯ç‰‡æ®µ', 'success');
                // å¯ä»¥åœ¨é€™è£¡é¡¯ç¤ºç‰‡æ®µä¿¡æ¯
            }
            
            // è™•ç†æ¨™é¡Œæ•¸æ“š  
            if (existingFiles.has_titles && existingData.titles) {
                showMessage('âœ“ ç™¼ç¾ç¾æœ‰æ¨™é¡Œæ•¸æ“š', 'success');
                
                // è‡ªå‹•è¼‰å…¥ç²¾è¯ç‰‡æ®µåˆ°å‰ç«¯
                if (existingData.titles.highlights) {
                    currentHighlights = existingData.titles.highlights;
                    renderHighlights(existingData.titles.highlights);
                    document.getElementById('highlightsSection').style.display = 'block';
                    document.getElementById('highlightsUpload').classList.add('active');
                    document.getElementById('highlightsUpload').querySelector('span').textContent = 'âœ“ å·²è¼‰å…¥ç¾æœ‰ç²¾è¯';
                }
            }
        }

        function exportAllHighlights() {
            if (currentHighlights.length === 0) {
                showMessage('æ²’æœ‰å¯å°å‡ºçš„æ‘˜è¦', 'error');
                return;
            }

            const data = {
                highlights: currentHighlights,
                timestamp: new Date().toLocaleString('zh-TW')
            };

            fetch('/export-all', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                throw new Error('å°å‡ºå¤±æ•—');
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `all_highlights_${currentHighlights.length}_segments.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showMessage(`æ‰€æœ‰ ${currentHighlights.length} å€‹æ‘˜è¦å·²å°å‡º`);
            })
            .catch(error => {
                showMessage('å°å‡ºå¤±æ•—: ' + error.message, 'error');
            });
        }

        function exportVideoSegment(index) {
            if (!currentVideo) {
                showMessage('è«‹å…ˆä¸Šå‚³è¦–é »æ–‡ä»¶', 'error');
                return;
            }

            const highlight = currentHighlights[index];
            const data = {
                video_filename: currentVideo,
                highlight: highlight
            };

            fetch('/export-video-segment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message);
                } else {
                    showMessage(data.error, 'error');
                }
            })
            .catch(error => {
                showMessage('å°å‡ºå¤±æ•—: ' + error.message, 'error');
            });
        }

        function toggleTimeControls(index) {
            const card = document.querySelectorAll('.highlight-card')[index];
            const timeControls = document.getElementById(`timeControls${index}`);
            
            // åˆ‡æ›å±•é–‹ç‹€æ…‹
            card.classList.toggle('expanded');
            timeControls.classList.toggle('show');
            
            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            const toggleBtn = card.querySelector('.preview-btn.primary');
            if (timeControls.classList.contains('show')) {
                toggleBtn.textContent = 'ğŸ”¼ æ”¶èµ·èª¿æ•´';
            } else {
                toggleBtn.textContent = 'âš™ï¸ èª¿æ•´æ™‚é–“';
            }
        }

        function previewAdjustedSegment(index) {
            const startInput = document.getElementById(`startTime${index}`);
            const endInput = document.getElementById(`endTime${index}`);
            
            const startTime = parseFloat(startInput.value);
            const endTime = parseFloat(endInput.value);
            
            if (startTime >= endTime) {
                showMessage('é–‹å§‹æ™‚é–“å¿…é ˆå°æ–¼çµæŸæ™‚é–“', 'error');
                return;
            }
            
            if (endTime - startTime < 5) {
                showMessage('ç‰‡æ®µé•·åº¦è‡³å°‘éœ€è¦5ç§’', 'error');
                return;
            }
            
            // æ’­æ”¾èª¿æ•´å¾Œçš„ç‰‡æ®µ
            playSegment(startTime, endTime);
            showMessage(`é è¦½ç‰‡æ®µ: ${formatTime(startTime)} - ${formatTime(endTime)}`);
        }

        function resetTimeRange(index) {
            const originalHighlight = currentHighlights[index];
            document.getElementById(`startTime${index}`).value = originalHighlight.start.toFixed(1);
            document.getElementById(`endTime${index}`).value = originalHighlight.end.toFixed(1);
            showMessage('æ™‚é–“ç¯„åœå·²é‡ç½®');
        }

        function saveTimeAdjustment(index) {
            const startInput = document.getElementById(`startTime${index}`);
            const endInput = document.getElementById(`endTime${index}`);
            
            const startTime = parseFloat(startInput.value);
            const endTime = parseFloat(endInput.value);
            
            if (startTime >= endTime) {
                showMessage('é–‹å§‹æ™‚é–“å¿…é ˆå°æ–¼çµæŸæ™‚é–“', 'error');
                return;
            }
            
            if (endTime - startTime < 5) {
                showMessage('ç‰‡æ®µé•·åº¦è‡³å°‘éœ€è¦5ç§’', 'error');
                return;
            }
            
            // æ›´æ–° currentHighlights æ•¸æ“š
            currentHighlights[index].start = startTime;
            currentHighlights[index].end = endTime;
            
            // æ›´æ–°é¡¯ç¤ºçš„æ™‚é–“
            const card = document.querySelectorAll('.highlight-card')[index];
            const timeDisplay = card.querySelector('.highlight-time');
            const duration = Math.round(endTime - startTime);
            timeDisplay.textContent = `${formatTime(startTime)} - ${formatTime(endTime)} (${duration}ç§’)`;
            
            // å•Ÿç”¨å°å‡ºæŒ‰éˆ•
            const exportBtn = card.querySelector('button[onclick*="exportVideoSegment"]');
            exportBtn.disabled = false;
            exportBtn.style.opacity = '1';
            
            // æ”¶èµ·èª¿æ•´é¢æ¿
            toggleTimeControls(index);
            
            showMessage('æ™‚é–“èª¿æ•´å·²ä¿å­˜ï¼Œå¯ä»¥å°å‡ºè¦–é »');
        }

        function exportAllVideoSegments() {
            if (!currentVideo) {
                showMessage('è«‹å…ˆä¸Šå‚³è¦–é »æ–‡ä»¶', 'error');
                return;
            }

            if (currentHighlights.length === 0) {
                showMessage('æ²’æœ‰å¯å°å‡ºçš„ç²¾è¯ç‰‡æ®µ', 'error');
                return;
            }

            const data = {
                video_filename: currentVideo,
                highlights: currentHighlights
            };

            showMessage('é–‹å§‹æ‰¹é‡å°å‡ºè¦–é »ç‰‡æ®µï¼Œè«‹ç¨å€™...', 'success');

            fetch('/export-all-video-segments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage(data.message);
                    if (data.failed_exports && data.failed_exports.length > 0) {
                        showMessage(`å¤±æ•—é …ç›®: ${data.failed_exports.join(', ')}`, 'error');
                    }
                } else {
                    showMessage(data.error, 'error');
                }
            })
            .catch(error => {
                showMessage('æ‰¹é‡å°å‡ºå¤±æ•—: ' + error.message, 'error');
            });
        }
    </script>
</body>
</html>